<!DOCTYPE html>
<html>
<head>
  <title>Bedrock - KnowledgeBase</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</title>

<!-- Style to fill remaining 
    horizontal space -->
</head>
<body>
  <h1>Bedrock - KnowledgeBase</h1>
  
  <form id="myForm">
    <label for="textField">Prompt:</label>
    <input type="text" id="textField" name="textField" size="40"><br>
    <label for="textField">Disciplina :</label>
    <input type="text" id="contextid" name="contextid" size="37" defaultValue="none"><br>
    <button type="button" onclick="openLink()">Enviar</button>
  </form>
  
  <div 
    id="linkContainer" style="display: none;">
  </div>
  <div id="History">
    <h2>Respostas: </h2>
  </div>
  
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script>
    function openLink() {
      var textField = document.getElementById("textField");
      var linkContainer = document.getElementById("linkContainer");
      var linkContent = document.getElementById("linkContent");
      var contextid = document.getElementById('contextid');
      if (typeof contextid !== "undefined" && contextid.value == '') {
        contextid = "undefined"
      }
      
      // Obter o conteÃºdo do campo de texto
      var inputText = textField.value;
      var contextidText = contextid.value;
    
      // Construir a URL do link
      const base_url = "BASE_URL"
      const requestUrl = base_url + "kb/?prompt=" + encodeURIComponent(inputText) + "&filter=" + encodeURIComponent(contextidText);

      // Construir resposta
      let html = '';
      const requestJSON = async url => {
          const response = await (await fetch(url)).json();
          console.log(response)
          html += "<hr><li> <b>Resultado:</b> " + response.body.answer + "<br><br>";   
          for (i = 0; i < response.body.citations.length; i++) {
            try {
              console.log(response.body.citations[i].retrievedReferences[0].location.s3Location.uri);
              html += "<b>Fonte: </b>" + response.body.citations[i].retrievedReferences[0].location.s3Location.uri + "<br>"; 
            }  catch (error) {
                console.log("Unknow s3Location.uri");
            }
          };
          html += "<br></li>"; 
          console.log(response.body.question)
          $("#History").append(html);
      }
      requestJSON(requestUrl);
      console.log(requestUrl);
      
    }

  </script>
</body>
</html>